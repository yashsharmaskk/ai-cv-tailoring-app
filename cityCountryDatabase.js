// City to Country mapping database for location detection
export const cityCountryDatabase = {
  // United States
  "new york": "United States",
  "san francisco": "United States", 
  "los angeles": "United States",
  "chicago": "United States",
  "boston": "United States",
  "seattle": "United States",
  "austin": "United States",
  "denver": "United States",
  "atlanta": "United States",
  "miami": "United States",
  "dallas": "United States",
  "houston": "United States",
  "philadelphia": "United States",
  "phoenix": "United States",
  "san diego": "United States",
  "portland": "United States",
  "washington": "United States",
  "las vegas": "United States",
  "detroit": "United States",
  "minneapolis": "United States",
  
  // Canada
  "toronto": "Canada",
  "vancouver": "Canada",
  "montreal": "Canada",
  "calgary": "Canada",
  "ottawa": "Canada",
  "edmonton": "Canada",
  "quebec city": "Canada",
  "winnipeg": "Canada",
  "hamilton": "Canada",
  "kitchener": "Canada",
  
  // United Kingdom
  "london": "United Kingdom",
  "manchester": "United Kingdom",
  "birmingham": "United Kingdom",
  "glasgow": "United Kingdom",
  "liverpool": "United Kingdom",
  "bristol": "United Kingdom",
  "leeds": "United Kingdom",
  "sheffield": "United Kingdom",
  "edinburgh": "United Kingdom",
  "cardiff": "United Kingdom",
  
  // Germany
  "berlin": "Germany",
  "munich": "Germany",
  "hamburg": "Germany",
  "cologne": "Germany",
  "frankfurt": "Germany",
  "stuttgart": "Germany",
  "dusseldorf": "Germany",
  "dortmund": "Germany",
  "essen": "Germany",
  "leipzig": "Germany",
  
  // France
  "paris": "France",
  "marseille": "France",
  "lyon": "France",
  "toulouse": "France",
  "nice": "France",
  "nantes": "France",
  "strasbourg": "France",
  "montpellier": "France",
  "bordeaux": "France",
  "lille": "France",
  
  // Australia
  "sydney": "Australia",
  "melbourne": "Australia",
  "brisbane": "Australia",
  "perth": "Australia",
  "adelaide": "Australia",
  "gold coast": "Australia",
  "newcastle": "Australia",
  "canberra": "Australia",
  "wollongong": "Australia",
  "geelong": "Australia",
  
  // India
  "mumbai": "India",
  "delhi": "India",
  "bangalore": "India",
  "hyderabad": "India",
  "chennai": "India",
  "kolkata": "India",
  "pune": "India",
  "ahmedabad": "India",
  "jaipur": "India",
  "surat": "India",
  "lucknow": "India",
  "kanpur": "India",
  "nagpur": "India",
  "indore": "India",
  "thane": "India",
  "bhopal": "India",
  "visakhapatnam": "India",
  "pimpri-chinchwad": "India",
  "patna": "India",
  "vadodara": "India",
  "ghaziabad": "India",
  "ludhiana": "India",
  "agra": "India",
  "nashik": "India",
  "faridabad": "India",
  "meerut": "India",
  "rajkot": "India",
  "kalyan-dombivli": "India",
  "vasai-virar": "India",
  "varanasi": "India",
  "srinagar": "India",
  "aurangabad": "India",
  "dhanbad": "India",
  "amritsar": "India",
  "navi mumbai": "India",
  "allahabad": "India",
  "ranchi": "India",
  "howrah": "India",
  "coimbatore": "India",
  "jabalpur": "India",
  "gwalior": "India",
  "vijayawada": "India",
  "jodhpur": "India",
  "madurai": "India",
  "raipur": "India",
  "kota": "India",
  "guwahati": "India",
  "chandigarh": "India",
  "solapur": "India",
  "hubli-dharwad": "India",
  "tiruchirappalli": "India",
  "bareilly": "India",
  "mysore": "India",
  "tiruppur": "India",
  "gurgaon": "India",
  "aligarh": "India",
  "jalandhar": "India",
  "bhubaneswar": "India",
  "salem": "India",
  "warangal": "India",
  "mira-bhayandar": "India",
  "thiruvananthapuram": "India",
  "bhiwandi": "India",
  "saharanpur": "India",
  "guntur": "India",
  "amravati": "India",
  "bikaner": "India",
  "noida": "India",
  "jamshedpur": "India",
  "bhilai nagar": "India",
  "cuttack": "India",
  "firozabad": "India",
  "kochi": "India",
  "bhavnagar": "India",
  "dehradun": "India",
  "durgapur": "India",
  "asansol": "India",
  "nanded": "India",
  "kolhapur": "India",
  "ajmer": "India",
  "gulbarga": "India",
  "jamnagar": "India",
  "ujjain": "India",
  "loni": "India",
  "siliguri": "India",
  "jhansi": "India",
  "ulhasnagar": "India",
  "nellore": "India",
  "jammu": "India",
  "sangli-miraj & kupwad": "India",
  "belgaum": "India",
  "mangalore": "India",
  "ambattur": "India",
  "tirunelveli": "India",
  "malegaon": "India",
  "gaya": "India",
  "jalgaon": "India",
  "udaipur": "India",
  "maheshtala": "India",
  
  // China
  "beijing": "China",
  "shanghai": "China",
  "guangzhou": "China",
  "shenzhen": "China",
  "tianjin": "China",
  "wuhan": "China",
  "dongguan": "China",
  "chengdu": "China",
  "nanjing": "China",
  "chongqing": "China",
  
  // Japan
  "tokyo": "Japan",
  "osaka": "Japan",
  "yokohama": "Japan",
  "nagoya": "Japan",
  "sapporo": "Japan",
  "fukuoka": "Japan",
  "kobe": "Japan",
  "kawasaki": "Japan",
  "kyoto": "Japan",
  "saitama": "Japan",
  
  // Netherlands
  "amsterdam": "Netherlands",
  "rotterdam": "Netherlands",
  "the hague": "Netherlands",
  "utrecht": "Netherlands",
  "eindhoven": "Netherlands",
  "tilburg": "Netherlands",
  "groningen": "Netherlands",
  "almere": "Netherlands",
  "breda": "Netherlands",
  "nijmegen": "Netherlands",
  
  // Singapore
  "singapore": "Singapore",
  
  // Dubai/UAE
  "dubai": "United Arab Emirates",
  "abu dhabi": "United Arab Emirates",
  "sharjah": "United Arab Emirates",
  "ajman": "United Arab Emirates",
  
  // Other major cities
  "hong kong": "Hong Kong",
  "zurich": "Switzerland",
  "geneva": "Switzerland",
  "stockholm": "Sweden",
  "copenhagen": "Denmark",
  "oslo": "Norway",
  "helsinki": "Finland",
  "brussels": "Belgium",
  "vienna": "Austria",
  "prague": "Czech Republic",
  "budapest": "Hungary",
  "warsaw": "Poland",
  "dublin": "Ireland",
  "lisbon": "Portugal",
  "madrid": "Spain",
  "barcelona": "Spain",
  "rome": "Italy",
  "milan": "Italy",
  "athens": "Greece",
  "istanbul": "Turkey",
  "moscow": "Russia",
  "st petersburg": "Russia",
  "tel aviv": "Israel",
  "jerusalem": "Israel",
  "cape town": "South Africa",
  "johannesburg": "South Africa",
  "lagos": "Nigeria",
  "cairo": "Egypt",
  "casablanca": "Morocco",
  "nairobi": "Kenya",
  "riyadh": "Saudi Arabia",
  "jeddah": "Saudi Arabia",
  "doha": "Qatar",
  "kuwait city": "Kuwait",
  "manama": "Bahrain",
  "muscat": "Oman",
  "tehran": "Iran",
  "baghdad": "Iraq",
  "damascus": "Syria",
  "beirut": "Lebanon",
  "amman": "Jordan",
  "tunis": "Tunisia",
  "algiers": "Algeria",
  "rabat": "Morocco",
  "addis ababa": "Ethiopia",
  "accra": "Ghana",
  "dar es salaam": "Tanzania",
  "kampala": "Uganda",
  "khartoum": "Sudan",
  "kinshasa": "Democratic Republic of the Congo",
  "luanda": "Angola",
  "maputo": "Mozambique",
  "harare": "Zimbabwe",
  "lusaka": "Zambia",
  "gaborone": "Botswana",
  "windhoek": "Namibia",
  "antananarivo": "Madagascar",
  "port louis": "Mauritius",
  "victoria": "Seychelles",
  "buenos aires": "Argentina",
  "sao paulo": "Brazil",
  "rio de janeiro": "Brazil",
  "lima": "Peru",
  "bogota": "Colombia",
  "caracas": "Venezuela",
  "santiago": "Chile",
  "mexico city": "Mexico",
  "guadalajara": "Mexico",
  "monterrey": "Mexico",
  "havana": "Cuba",
  "kingston": "Jamaica",
  "san juan": "Puerto Rico",
  "panama city": "Panama",
  "san jose": "Costa Rica",
  "guatemala city": "Guatemala",
  "managua": "Nicaragua",
  "tegucigalpa": "Honduras",
  "san salvador": "El Salvador",
  "belize city": "Belize",
  "quito": "Ecuador",
  "la paz": "Bolivia",
  "asuncion": "Paraguay",
  "montevideo": "Uruguay",
  "georgetown": "Guyana",
  "paramaribo": "Suriname",
  "cayenne": "French Guiana"
};

// Function to detect country from city name
export function detectCountryFromCity(cityName) {
  if (!cityName) return null;
  
  const normalizedCity = cityName.toLowerCase().trim();
  
  // Direct lookup
  if (cityCountryDatabase[normalizedCity]) {
    return cityCountryDatabase[normalizedCity];
  }
  
  // Try partial matching for cities with state/province info
  for (const [city, country] of Object.entries(cityCountryDatabase)) {
    if (normalizedCity.includes(city) || city.includes(normalizedCity)) {
      return country;
    }
  }
  
  return null;
}

// Function to format location with city and country
export function formatLocationWithCountry(location, detectedCountry) {
  if (!location) return null;
  
  // If location already contains country info, return as is
  if (location.includes(',') && location.split(',').length >= 2) {
    const parts = location.split(',').map(p => p.trim());
    if (parts.length >= 2) {
      // Check if last part might be a country
      const lastPart = parts[parts.length - 1].toLowerCase();
      const countryNames = [...new Set(Object.values(cityCountryDatabase))];
      const hasCountry = countryNames.some(country => 
        country.toLowerCase().includes(lastPart) || lastPart.includes(country.toLowerCase())
      );
      
      if (hasCountry) {
        return location; // Already has country
      }
    }
  }
  
  // Add detected country if available
  if (detectedCountry) {
    return `${location}, ${detectedCountry}`;
  }
  
  return location;
}
